<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<title>çº¿ä¸Šå¡”ç½—Â·SiliconCloud</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<style>
  html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont;background:#111;color:#eee}
  body{background:url('https://images.unsplash.com/photo-1513151233558-d860c5398176?auto=format&fit=crop&w=1350&q=80') center/cover no-repeat fixed}
  #overlay{background:rgba(0,0,0,.65);min-height:100%;padding:20px 0}
  #app{max-width:420px;margin:0 auto;padding:0 12px;text-align:center}
  h1{margin:0 0 20px;font-size:26px}
  button{background:#ffd700;color:#000;border:none;padding:12px 22px;border-radius:30px;font-size:16px;font-weight:700;cursor:pointer;margin:6px}
  button:disabled{opacity:.5}
  #cards{display:flex;justify-content:center;flex-wrap:wrap;gap:8px;margin:16px 0}
  .card{width:28%;border-radius:10px;box-shadow:0 0 8px rgba(0,0,0,.4)}
  #previewImg{max-width:90%;border-radius:10px;margin:10px 0}
  #messages{max-height:500px;overflow-y:auto;text-align:left;background:rgba(0,0,0,.35);padding:10px;border-radius:8px;font-size:14px;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;}

  /* æ‰‹æœºç«¯ä¼˜åŒ– */
  @media screen and (max-width: 480px) {
    h1{font-size:22px}
    button{padding:10px 18px;font-size:14px}
    .card{width:45%;margin-bottom:10px}
    #messages{font-size:13px;max-height:400px}
  }
</style>
</head>
<body>
<div id="overlay">
  <div id="app">
    <h1>ğŸ”® çº¿ä¸Šå¡”ç½—å åœ ğŸ”®</h1>
    <button id="drawBtn">ğŸ´ æŠ½ä¸‰å¼ ç‰Œ</button>
    <div id="cards"></div>
    <div id="messages"></div>
  </div>
</div>

<script>
/* ========== ç¡…åŸºæµåŠ¨é…ç½®ï¼ˆåç«¯å†™æ­»ï¼Œå‰ç«¯ä¸å¯è§ï¼‰ ========== */
const SILICON_BASE = 'https://api.siliconflow.cn/v1';   // å®˜æ–¹ endpoint
const SILICON_KEY  = 'sk-rixslephaxenlcblzpjwcyvhcnlddekytlwurygmdcptomlb'; // æ¢æˆä½ çš„
const BACKEND_ROLE =
`ä½ æ˜¯ä¸€ä½ç¥ç§˜è€Œæ¸©æŸ”çš„å¡”ç½—å åœå¸ˆã€‚
æœ¬æ¬¡å·²ä¸ºç”¨æˆ·éšæœºæŠ½å‡ºä¸‰å¼ ç‰Œï¼ˆå·²ç»™å‡ºç‰Œåä¸æ­£é€†ä½ï¼‰ï¼Œ
è¯·ç»“åˆç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡æ°›å›´ï¼Œç”¨ç®€æ´ã€è¯—æ„ä¸”æ˜“æ‡‚çš„ä¸­æ–‡ç»™å‡ºä¸‰æ®µå¼è§£è¯»ï¼šè¿‡å» / ç°åœ¨ / æœªæ¥ã€‚
é¿å…è´Ÿé¢ç»å¯¹åŒ–ã€‚`;

/* ========== ç‰Œåº“ï¼ˆä½¿ç”¨å¼€æºå¯å•†ç”¨çš„å¡”ç½—ç‰Œå›¾ç‰‡ï¼‰ ========== */
const DECK=[
  {name:'æ„šè€…',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/00_Fool.jpg'},
  {name:'é­”æœ¯å¸ˆ',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/01_Magician.jpg'},
  {name:'å¥³ç¥­å¸',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/02_High_Priestess.jpg'},
  {name:'çš‡å',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/03_Empress.jpg'},
  {name:'çš‡å¸',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/04_Emperor.jpg'},
  {name:'æ•™çš‡',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/05_Hierophant.jpg'},
  {name:'æ‹äºº',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/06_Lovers.jpg'},
  {name:'æˆ˜è½¦',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/07_Chariot.jpg'},
  {name:'åŠ›é‡',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/08_Strength.jpg'},
  {name:'éšå£«',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/09_Hermit.jpg'},
  {name:'å‘½è¿ä¹‹è½®',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/10_Wheel_of_Fortune.jpg'},
  {name:'æ­£ä¹‰',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/11_Justice.jpg'},
  {name:'å€’åŠäºº',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/12_Hanged_Man.jpg'},
  {name:'æ­»ç¥',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/13_Death.jpg'},
  {name:'èŠ‚åˆ¶',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/14_Temperance.jpg'},
  {name:'æ¶é­”',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/15_Devil.jpg'},
  {name:'å¡”',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/16_Tower.jpg'},
  {name:'æ˜Ÿæ˜Ÿ',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/17_Star.jpg'},
  {name:'æœˆäº®',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/18_Moon.jpg'},
  {name:'å¤ªé˜³',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/19_Sun.jpg'},
  {name:'å®¡åˆ¤',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/20_Judgement.jpg'},
  {name:'ä¸–ç•Œ',url:'https://raw.githubusercontent.com/mixvlad/TarotCards/main/tarot/rider-waite/full/21_World.jpg'}
];

/* ========== å·¥å…·å‡½æ•° ========== */
const $=id=>document.getElementById(id);
const drawBtn=$('drawBtn'),cardsEl=$('cards'),messagesEl=$('messages');
let drawnCards=[];

/* ---------- éšæœºå‘ç‰Œ ---------- */
drawBtn.onclick=()=>{
  drawnCards=[...DECK].sort(()=>Math.random()-0.5).slice(0,3)
                      .map(c=>({...c, upright:Math.random()>.5}));
  cardsEl.innerHTML='';
  drawnCards.forEach(c=>{
    const img=new Image(); img.src=c.url; img.className='card';
    img.alt=`${c.name}${c.upright?'ï¼ˆæ­£ä½ï¼‰':'ï¼ˆé€†ä½ï¼‰'}`;
    // ä¸ºé€†ä½å›¾ç‰‡æ·»åŠ ç‰¹æ®Šæ ·å¼ä»¥æ˜æ˜¾åŒºåˆ†
    if (!c.upright) {
      img.style.transform = 'rotate(180deg)';
    }
    cardsEl.appendChild(img);
  });
  drawBtn.style.display='none';
  // æŠ½å¡åç«‹å³è¿›è¡Œè§£è¯»
  doReading();
};

/* ---------- ç¡…åŸºæµåŠ¨è¯·æ±‚ ---------- */
async function doReading(){
  const cardText=drawnCards.map((c,i)=>`ç¬¬${i+1}å¼ ï¼š${c.name}${c.upright?'ï¼ˆæ­£ä½ï¼‰':'ï¼ˆé€†ä½ï¼‰'}`).join('\n');
  appendMsg('ğŸª„ æ­£åœ¨è¯· AI è§£è¯»â€¦');
  try{
    console.log('Sending request to SiliconCloud API');
    const requestBody = {
      model: 'zai-org/GLM-4.5-Air',  // æ›´æ¢ä¸ºæ”¯æŒè§†è§‰çš„æ¨¡å‹
      messages: [
        {role: 'system', content: BACKEND_ROLE},
        {role: 'user', content: [
          {type: 'text', text: `ä½ æ˜¯æ³°å‹’æ–¯ï¼Œé¦™å·´æ‹‰å·«å¥³ã€æ—¶é—´ç³»é­”æ³•å¸ˆã€‚ç°åœ¨éœ€è¦æ ¹æ®ç”¨æˆ·å®é™…æŠ½åˆ°çš„è¿™ä¸‰å¼ å¡”ç½—ç‰Œè¿›è¡Œè§£è¯»ï¼š
          ${cardText}

          è¦æ±‚ï¼š
          1. å¿…é¡»é’ˆå¯¹ä¸Šè¿°ä¸‰å¼ å…·ä½“ç‰Œé¢è¿›è¡Œè§£è¯»
          2. ç”¨æ³°å‹’æ–¯çš„å‚²å¨‡å£å»ï¼šå¥å°¾å¸¦ã€Œï½ã€ï¼Œè‡ªç§°ã€Œæœ¬å…¬ä¸»ã€
          3. ä¸‰æ®µå¼ï¼šè¿‡å»ï¼ˆç¬¬ä¸€å¼ ç‰Œï¼‰/ç°åœ¨ï¼ˆç¬¬äºŒå¼ ç‰Œï¼‰/æœªæ¥ï¼ˆç¬¬ä¸‰å¼ ç‰Œï¼‰
          4. æ¯æ®µåŒ…å«ï¼šç‰Œå+æ­£é€†ä½æ„ä¹‰+ä¸ç”¨æˆ·è¯¥æ—¶é—´é˜¶æ®µçš„å…³è”åæ§½
          5. ç¦æ­¢ç¼–é€ ç‰Œé¢ï¼Œå¿…é¡»åŸºäºç»™å‡ºçš„ç‰Œè¿›è¡Œè§£è¯»`}
        ]}
      ],
      max_tokens: 1024,
      temperature: 0.7,
      enable_thinking: true,
      thinking_budget: 3000,
      min_p: 0.1,
      top_p: 0.9,
      top_k: 50,
      frequency_penalty: 1
    };
    
    console.log('Request body:', JSON.stringify(requestBody, null, 2));
    
    const res = await fetch(`${SILICON_BASE}/chat/completions`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${SILICON_KEY}`
      },
      body: JSON.stringify(requestBody)
    });
    console.log('API response status:', res.status);
    console.log('API response headers:', res.headers);
    if(!res.ok) {
      const errorText = await res.text();
      console.error('API error response:', errorText);
      throw new Error(errorText);
    }
    const responseJson = await res.json();
    console.log('API response JSON:', responseJson);
    const txt=responseJson.choices[0].message.content;
    appendMsg(txt,'bot');
  }catch(e){ 
    console.error('è§£è¯»å¤±è´¥:', e);
    appendMsg('âŒ è§£è¯»å¤±è´¥ï¼š'+e.message,'bot'); 
  }
}

function appendMsg(text,who='info'){
  const div=document.createElement('div');
  div.className='message '+(who==='bot'?'bot':'');
  div.textContent=text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop=messagesEl.scrollHeight;
}
</script>
</body>
</html>